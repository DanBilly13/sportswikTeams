<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <!-- Figma Plugin DS from CDN -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/figma-plugin-ds@1.0.1/dist/figma-plugin-ds.css"
    />
    <script src="https://unpkg.com/figma-plugin-ds@1.0.1/dist/figma-plugin-ds.js"></script>
    <style>
      body.container {
        padding: 12px;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }
      .rowDan {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
        border-bottom: 1px solid var(--c-medium-grey);
        margin-bottom: 16px;
        padding-bottom: 16px;
      }
      #log {
        background: #f6f8fb;
        border: 1px solid #dfe3ea;
        border-radius: 6px;
        padding: 8px;
        height: 120px;
        overflow: auto;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      }
      .section + .section {
        margin-top: 16px;
      }
      /* Field spacing */
      .field + .field {
        margin-top: 8px;
      }

      /* Helper/caption text */
      .helper {
        margin-top: 6px;
        opacity: 0.7;
      }

      /* Align form elements to left edge and unify typography */
      .checkbox__label {
        font-size: 13px;
        font-family: Inter, sans-serif;
        line-height: 20px;
        display: flex;
        height: auto;
        margin-left: 6px;
      }

      /* Align form elements to left edge and unify typography */
      .label.label,
      .radio__label,
      .helper,
      .button,
      input,
      select {
        font-size: 13px;
        font-family: Inter, sans-serif;
        line-height: 20px;
        display: flex;
        height: auto;
      }
      .section,
      .field,
      .input {
        align-items: flex-start;
      }
      label.label {
        display: block;
        margin-bottom: 8px;
        padding-left: 0;
      }
      .checkbox,
      .radio {
        align-items: center;
      }

      .radio__label {
        margin-left: 4px;
      }

      /* Force consistent left alignment for all form fields */
      .section,
      .field,
      .input {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }

      .checkbox,
      .radio {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 6px;
      }

      .label,
      .radio__label,
      .helper {
        margin-left: 0 !important;
      }

      .field select.select-menu,
      .field input.input__field {
        align-self: stretch;
      }

      /* Right-aligned actions */
      .actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        margin-top: 0px;
      }

      /* Compact number input */
      .input--short {
        width: 80px;
        display: block;
      }

      /* Figma-like text input */
      input[type="text"].input__field {
        border: 1px solid var(--c-medium-grey);
        border-radius: 6px;
        background-color: var(--c-light-grey);
        font-family: Inter, sans-serif;
        font-size: 13px;
        line-height: 20px;
        padding: 4px 8px;
        color: var(--c-black);
        width: 100%;
      }
      input[type="text"].input__field:hover {
        background-color: #ffffff;
        border-color: #b3b3b3;
      }
      input[type="text"].input__field:focus {
        outline: none;
        border-color: var(--c-primary);
        box-shadow: 0 0 0 1px var(--c-primary) inset;
      }

      /* Figma-like number input */
      input[type="number"].input__field {
        appearance: textfield;
        -moz-appearance: textfield;
        border: 1px solid var(--c-medium-grey);
        border-radius: 6px;
        background-color: var(--c-light-grey);
        font-family: Inter, sans-serif;
        font-size: 13px;
        line-height: 20px;
        padding: 4px 8px;
        color: var(--c-black);
        width: 100%;
      }
      input[type="number"].input__field:hover {
        background-color: #ffffff;
        border-color: #b3b3b3;
      }
      input[type="number"].input__field:focus {
        outline: none;
        border-color: var(--c-primary);
        box-shadow: 0 0 0 1px var(--c-primary) inset;
      }
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        opacity: 1;
        appearance: none;
        -webkit-appearance: none;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10"><path fill="%23999" d="M5 0l3 3H2zM2 7l3 3 3-3z"/></svg>')
          no-repeat center;
        background-position: right 4px center;
      }

      /* Reveal avatar style radios when checkbox checked (no JS needed) */
      #avatarStyleRow {
        display: none;
        gap: 8px;
        margin-top: 8px;
      }
      #useAvatar:checked ~ #avatarStyleRow {
        display: flex;
      }

      /* Fallback: show native select if DS enhancement fails to load */
      select.select-menu {
        display: block;
        width: 100%;
      }
      /* Figma-like dropdown appearance */
      select.select-menu {
        appearance: none;
        -webkit-appearance: none;
        border: 1px solid var(--c-medium-grey);
        border-radius: 6px;
        background-color: var(--c-light-grey);
        font-family: Inter, sans-serif;
        font-size: 13px;
        line-height: 20px;
        padding: 4px 28px 4px 8px;
        color: var(--c-black);
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="10" height="6" viewBox="0 0 10 6"><path fill="%23999" d="M0 0l5 6 5-6z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 10px 6px;
      }
      select.select-menu:hover {
        background-color: #ffffff;
        border-color: #b3b3b3;
      }
      select.select-menu:focus {
        outline: none;
        border-color: var(--c-primary);
        box-shadow: 0 0 0 1px var(--c-primary) inset;
      }

      /* Custom Figma-like checkbox */
      .checkbox-custom {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: Inter, sans-serif;
        font-size: 13px;
        line-height: 20px;
        color: var(--c-black);
        cursor: pointer;
        user-select: none;
      }
      .checkbox-custom input[type="checkbox"] {
        width: 14px;
        height: 14px;
        border: 1px solid var(--c-medium-grey);
        border-radius: 3px;
        appearance: none;
        -webkit-appearance: none;
        background-color: #fff;
        margin: 0;
        cursor: pointer;
      }
      .checkbox-custom input[type="checkbox"]:hover {
        border-color: #888;
      }
      .checkbox-custom input[type="checkbox"]:focus {
        outline: none;
        box-shadow: 0 0 0 1px var(--c-primary) inset;
        border-color: var(--c-primary);
      }
      .checkbox-custom input[type="checkbox"]:checked {
        background-color: var(--c-primary);
        border-color: var(--c-primary);
        background-repeat: no-repeat;
        background-position: center;
        background-size: 12px 12px;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14"><path d="M3 7l3 3 6-6" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
      }

      /* Custom Figma-like radio */
      .radio-custom {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        user-select: none;
      }
      .radio-custom input[type="radio"] {
        width: 14px;
        height: 14px;
        border: 1px solid var(--c-medium-grey);
        border-radius: 50%;
        appearance: none;
        -webkit-appearance: none;
        background-color: #fff;
        margin: 0;
        position: relative;
      }
      .radio-custom input[type="radio"]:hover {
        border-color: #888;
      }
      .radio-custom input[type="radio"]:focus {
        outline: none;
        box-shadow: 0 0 0 1px var(--c-primary) inset;
        border-color: var(--c-primary);
      }
      .radio-custom input[type="radio"]:checked {
        border-color: var(--c-primary);
      }
      .radio-custom input[type="radio"]:checked::after {
        content: "";
        position: absolute;
        inset: 3px;
        border-radius: 50%;
        background: var(--c-primary);
      }
      /* Ensure custom radios use identical typography everywhere */
      .radio-custom,
      .radio-custom span {
        font-family: var(--t-font);
        font-size: 13px;
        line-height: 20px;
        color: var(--c-black);
      }
      /* Normalize spacing between stacked radios */
      #competition-group .radio-custom + .radio-custom,
      [id^="role"] .radio-custom + .radio-custom,
      .field .radio-custom + .radio-custom {
        margin-top: 4px;
      }
      /* Guard against DS styles leaking into our custom radios */
      .radio-custom input[type="radio"] {
        appearance: none;
        -webkit-appearance: none;
        background-color: #fff;
      }
      .radio-custom input[type="radio"]:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* --- Unified color palette --- */
      :root {
        --c-primary: #007aff; /* Figma blue */
        --c-black: #000000;
        --c-dark-grey: #6e6e6e;
        --c-medium-grey: #e0e0e0;
        --c-light-grey: #f9f9f9;
      }

      /* --- Unified type scale --- */
      :root {
        --t-font: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI,
          Roboto, Helvetica, Arial, sans-serif;
      }
      .t-header {
        font-family: var(--t-font);
        font-weight: 600;
        font-size: 16px;
        line-height: 24px;
        color: var(--c-black);
      }
      .t-subheader {
        font-family: var(--t-font);
        font-weight: 600;
        font-size: 13px;
        line-height: 20px;
        color: var(--c-dark-grey);
      }
      .t-label {
        font-family: var(--t-font);
        font-weight: 400;
        font-size: 13px;
        line-height: 20px;
        color: var(--c-dark-grey);
      }
      .t-body {
        font-family: var(--t-font);
        font-weight: 400;
        font-size: 13px;
        line-height: 20px;
        color: var(--c-black);
      }
      .t-primary {
        color: var(--c-primary);
        font-weight: 400;
      }
      /* --- Custom Figma-like buttons --- */
      .btn {
        font-family: var(--t-font);
        font-size: 13px;
        line-height: 20px;
        font-weight: 500;
        border-radius: 6px;
        padding: 6px 12px;
        cursor: pointer;
        transition: all 0.15s ease-in-out;
      }
      .btn-primary {
        background-color: var(--c-primary);
        color: #fff;
        border: 1px solid var(--c-primary);
      }
      .btn-primary:hover {
        background-color: #006ae6;
      }
      .btn-primary:active {
        background-color: #005ac2;
      }
      .btn-secondary {
        background-color: #fff;
        color: var(--c-primary);
        border: 1px solid var(--c-primary);
      }
      .btn-secondary:hover {
        background-color: var(--c-light-grey);
      }
      .btn-secondary:active {
        background-color: var(--c-medium-grey);
      }
      /* --- Loader / Spinner --- */
      .spinner-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.75);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }
      .spinner-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      .spinner {
        width: 28px;
        height: 28px;
        border: 2px solid var(--c-medium-grey);
        border-top-color: var(--c-primary);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      .spinner-text {
        font-family: var(--t-font);
        font-size: 13px;
        color: var(--c-dark-grey);
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="container container--thin">
    <!-- Row Dan -->
    <div class="rowDan">
      <div class="section">
        <h1 class="t-header">Sportswik Teams</h1>
      </div>
    </div>
    <!-- Row Dan -->

    <!-- Hidden base (badgeBase only, unchanged) -->
    <input
      id="badgeBase"
      type="hidden"
      value="https://cdn.jsdelivr.net/gh/DanBilly13/sportswikTeams@main"
    />

    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="field">
          <label class="label t-label" for="competition">Competition</label>
          <select id="competition" class="select-menu">
            <option value="Elite League" selected>Elite League</option>
            <option value="Nordic Cup">Nordic Cup</option>
            <option value="Baltic Challenge">Baltic Challenge</option>
            <option value="National Qualifier">National Qualifier</option>
            <option value="Youth Invitational">Youth Invitational</option>
            <option value="__random">Random competition</option>
          </select>
          <div class="type type--small helper">
            Choose or randomize the competition name.
          </div>
        </div>
      </div>
    </div>

    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="field">
          <label class="label t-label" for="region">Region</label>
          <select id="region" class="select-menu">
            <option value="Northland" selected>Region A — Northland</option>
            <option value="Riverview">Region B — Riverview</option>
            <option value="Silver Coast">Region C — Silver Coast</option>
            <option value="Pinecrest">Region D — Pinecrest</option>
            <option value="Lakewood">Region E — Lakewood</option>
            <option value="__random">Random Region</option>
          </select>
          <div class="type type--small helper">
            Choose or randomize the region.
          </div>
        </div>
      </div>
    </div>

    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="field">
          <label class="label t-label" for="federation">Federation</label>
          <select id="federation" class="select-menu">
            <option value="Northern Football Union" selected>
              Federation A — Northern Football Union
            </option>
            <option value="Coastal Football Council">
              Federation B — Coastal Football Council
            </option>
            <option value="Central League Federation">
              Federation C — Central League Federation
            </option>
            <option value="Highlands Association">
              Federation D — Highlands Association
            </option>
            <option value="Eastshore Federation">
              Federation E — Eastshore Federation
            </option>
            <option value="__random">Random Federation</option>
          </select>
          <div class="type type--small helper">
            Choose or randomize the federation.
          </div>
        </div>
      </div>
    </div>
    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="field">
          <label class="label t-label" for="venue">Venue</label>
          <select id="venue" class="select-menu">
            <option value="Vildmannavallen IP" selected>
              Venue A — Vildmannavallen IP
            </option>
            <option value="Skellefteå Arena">Venue B — Skellefteå Arena</option>
            <option value="Umeå Stadium">Venue C — Umeå Stadium</option>
            <option value="Kiruna Park">Venue D — Kiruna Park</option>
            <option value="Växjö Sports Center">
              Venue E — Växjö Sports Center
            </option>
            <option value="__random">Random Venue</option>
          </select>
          <div class="type type--small helper">
            Choose or randomize the venue.
          </div>
        </div>
      </div>
    </div>
    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="field">
          <label class="label t-label" for="badgeLibrary">Badge Badges</label>
          <select id="badgeLibrary" class="select-menu">
            <option value="gotSports" selected>GotSports (home/away)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="t-subheader">Score</div>
        <label class="checkbox-custom t-body">
          <input id="scoreRandom" type="checkbox" checked />
          <span>Random scores (0–6)</span>
        </label>
        <div class="row">
          <div class="field">
            <label class="label t-label" for="homeScore">Home score</label>
            <input
              id="homeScore"
              type="number"
              min="0"
              max="99"
              value="0"
              class="input__field input--short"
            />
          </div>
          <div class="field">
            <label class="label t-label" for="awayScore">Away score</label>
            <input
              id="awayScore"
              type="number"
              min="0"
              max="99"
              value="0"
              class="input__field input--short"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="t-subheader">Team name</div>
        <div class="field">
          <label class="label t-label" for="teamNameOpt">Team name</label>
          <select id="teamNameOpt" class="select-menu">
            <option value="boys-u12" selected>BOYS U12</option>
            <option value="boys-u16">BOYS U16</option>
            <option value="div3-boys">Division 3 Boys</option>
            <option value="div2-boys">Division 2 Boys</option>
            <option value="__random-boys">Random Boys</option>
            <option value="girls-u12">GIRLS U12</option>
            <option value="girls-u16">GIRLS U16</option>
            <option value="div3-girls">Division 3 Girls</option>
            <option value="div2-girls">Division 2 Girls</option>
            <option value="__random-girls">Random Girls</option>
            <option value="__random-mixed">Random Mixed</option>
          </select>
          <div class="type type--small helper">
            Choose or randomize the team name.
          </div>
        </div>
      </div>
    </div>

    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="t-subheader">Date & time</div>
        <div class="field">
          <label class="label t-label">Date</label>
          <label class="radio-custom t-body">
            <input type="radio" name="dateMode" value="off" checked />
            <span>Off</span>
          </label>
          <label class="radio-custom t-body">
            <input type="radio" name="dateMode" value="sequential" />
            <span>Sequential (today, yesterday, …)</span>
          </label>
          <label class="radio-custom t-body">
            <input type="radio" name="dateMode" value="random" />
            <span>Random order (recent days)</span>
          </label>
        </div>
        <div class="field" style="margin-top: 8px">
          <label class="label t-label">Time</label>
          <label class="radio-custom t-body">
            <input type="radio" name="timeMode" value="off" checked />
            <span>Off</span>
          </label>
          <label class="radio-custom t-body">
            <input type="radio" name="timeMode" value="sequential" />
            <span>Sequential within 09:00–19:00</span>
          </label>
          <label class="radio-custom t-body">
            <input type="radio" name="timeMode" value="random" />
            <span>Random within 09:00–19:00</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Row Dan -->
    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="t-subheader">Money helper</div>

        <div class="field">
          <label class="label t-label" for="currency">Currency</label>
          <select id="currency" class="select-menu">
            <option value="SEK" selected>SEK — Swedish krona</option>
            <option value="CHF">CHF — Swiss franc</option>
            <option value="USD">USD — United States dollar</option>
            <option value="EUR">EUR — Euro</option>
            <option value="GBP">GBP — Pound sterling</option>
            <option value="CAD">CAD — Canadian dollar</option>
          </select>
          <div class="type type--small helper">
            Used as an abbreviation suffix (e.g. “456 SEK”).
          </div>
        </div>

        <div class="field">
          <label class="label t-label" for="amt1">Amount 1</label>
          <select id="amt1" class="select-menu">
            <option value="50">Random ≤ 50</option>
            <option value="500" selected>Random ≤ 500</option>
            <option value="5000">Random ≤ 5000</option>
          </select>
        </div>

        <div class="field">
          <label class="label t-label" for="amt2">Amount 2</label>
          <select id="amt2" class="select-menu">
            <option value="50">Random ≤ 50</option>
            <option value="500" selected>Random ≤ 500</option>
            <option value="5000">Random ≤ 5000</option>
          </select>
        </div>

        <div class="field">
          <label class="label t-label" for="amt3">Amount 3</label>
          <select id="amt3" class="select-menu">
            <option value="50">Random ≤ 50</option>
            <option value="500" selected>Random ≤ 500</option>
            <option value="5000">Random ≤ 5000</option>
          </select>
        </div>
      </div>
    </div>

    <div class="rowDan">
      <div
        class="section"
        style="display: flex; flex-direction: column; gap: 8px; width: 100%"
      >
        <div class="t-subheader">Quantity helper</div>

        <div class="field">
          <label class="label t-label" for="qty1">Quantity 1</label>
          <select id="qty1" class="select-menu">
            <option value="50">Random ≤ 50</option>
            <option value="500" selected>Random ≤ 500</option>
            <option value="5000">Random ≤ 5000</option>
          </select>
        </div>

        <div class="field">
          <label class="label t-label" for="qty2">Quantity 2</label>
          <select id="qty2" class="select-menu">
            <option value="50">Random ≤ 50</option>
            <option value="500" selected>Random ≤ 500</option>
            <option value="5000">Random ≤ 5000</option>
          </select>
        </div>

        <div class="field">
          <label class="label t-label" for="qty3">Quantity 3</label>
          <select id="qty3" class="select-menu">
            <option value="50">Random ≤ 50</option>
            <option value="500" selected>Random ≤ 500</option>
            <option value="5000">Random ≤ 5000</option>
          </select>
        </div>
      </div>
    </div>

    <div class="rowDan">
      <div class="actions">
        <button id="scan" class="btn btn-secondary">Scan</button>
        <button id="populate" class="btn btn-primary">Populate</button>
      </div>
    </div>

    <div class="rowDan">
      <div class="t-subheader">How to use</div>
      <div class="t-body" style="margin-top: 6px">
        To populate, select one or more frames or components containing text
        layers named:
        <ul style="margin: 6px 0 6px 16px; padding-left: 0">
          <li>
            <span class="t-primary">player-name</span> — player or team member
            name
          </li>
          <li><span class="t-primary">shirt-number</span> — shirt number</li>
          <li>
            <span class="t-primary">competition</span>,
            <span class="t-primary">region</span>,
            <span class="t-primary">federation</span>,
            <span class="t-primary">venue</span> — competition details
          </li>
          <li>
            <span class="t-primary">home-team-name</span> and
            <span class="t-primary">away-team-name</span> — team labels for each
            side (fallback: a single
            <span class="t-primary">team-name</span> layer is also supported)
          </li>
          <li>
            <span class="t-primary">home-club-name</span> and
            <span class="t-primary">away-club-name</span> — optional club names
            mapped to badges
          </li>
          <li>
            Shapes named <span class="t-primary">home-badge</span> and
            <span class="t-primary">away-badge</span> — badges are placed as
            image fills
          </li>
          <li>
            <span class="t-primary">home-score</span> and
            <span class="t-primary">away-score</span> — numeric score text
          </li>
          <li>
            <span class="t-primary">amount-1</span>,
            <span class="t-primary">amount-2</span>,
            <span class="t-primary">amount-3</span> — amounts with currency
            (e.g. “456 SEK”)
          </li>
          <li>
            <span class="t-primary">qty-1</span>,
            <span class="t-primary">qty-2</span>,
            <span class="t-primary">qty-3</span> — plain quantities (numbers
            only)
          </li>
          <li>
            <span class="t-primary">date</span> — optional date (YYYY-MM-DD)
          </li>
          <li><span class="t-primary">time</span> — optional time (HH:MM)</li>
        </ul>
        The plugin supports randomization for competition, region, federation,
        and venue. Simply select “Random …” for any of those sections before
        populating.
      </div>
    </div>

    <pre id="log" class="type type--small"></pre>

    <div id="spinner" class="spinner-overlay" aria-hidden="true" role="status">
      <div class="spinner-box">
        <div class="spinner" aria-label="Loading"></div>
        <div class="spinner-text">Populating… this can take a moment</div>
        <button
          id="spinner-hide"
          class="btn btn-secondary"
          style="padding: 4px 8px; font-weight: 400"
        >
          Hide
        </button>
      </div>
    </div>

    <script>
      const log = (obj) => {
        const pre = document.getElementById("log");
        pre.textContent =
          typeof obj === "string" ? obj : JSON.stringify(obj, null, 2);
      };

      // Spinner helpers
      const spinnerEl = document.getElementById("spinner");
      const hideSpinnerBtn = document.getElementById("spinner-hide");
      const scanBtn = document.getElementById("scan");
      const populateBtn = document.getElementById("populate");
      let spinnerTimeout = null;
      function showSpinner() {
        spinnerEl.style.display = "flex";
        scanBtn.disabled = true;
        populateBtn.disabled = true;
        // Safety auto-hide after 60s (does not cancel the job, only the overlay)
        clearTimeout(spinnerTimeout);
        spinnerTimeout = setTimeout(hideSpinner, 60000);
      }
      function hideSpinner() {
        spinnerEl.style.display = "none";
        scanBtn.disabled = false;
        populateBtn.disabled = false;
        clearTimeout(spinnerTimeout);
      }
      hideSpinnerBtn.addEventListener("click", hideSpinner);

      // Initialize Figma DS select menu and wire it to hidden input
      try {
        if (window.selectMenu && typeof window.selectMenu.init === "function") {
          window.selectMenu.init();
        }
      } catch (e) {
        /* no-op: DS script optional */
      }

      // Score inputs enable/disable
      const scoreRandEl = document.getElementById("scoreRandom");
      const homeScoreEl = document.getElementById("homeScore");
      const awayScoreEl = document.getElementById("awayScore");
      function syncScoreInputs() {
        const isRand = !!(scoreRandEl && scoreRandEl.checked);
        if (homeScoreEl) homeScoreEl.disabled = isRand;
        if (awayScoreEl) awayScoreEl.disabled = isRand;
      }
      if (scoreRandEl) scoreRandEl.addEventListener("change", syncScoreInputs);
      syncScoreInputs();

      onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (!msg) return;
        if (msg.type === "scan-result") log(msg.payload);
        if (msg.type === "error") {
          log(msg.payload);
          hideSpinner();
        }
        if (msg.type === "populate-done") {
          hideSpinner();
        }
      };

      document.getElementById("scan").onclick = () => {
        parent.postMessage({ pluginMessage: { type: "scan" } }, "*");
      };

      document.getElementById("populate").onclick = async () => {
        // Date/Time modes
        const dateModeEl = document.querySelector(
          'input[name="dateMode"]:checked'
        );
        const timeModeEl = document.querySelector(
          'input[name="timeMode"]:checked'
        );
        const dateMode = dateModeEl ? dateModeEl.value : "off"; // off | sequential | random
        const timeMode = timeModeEl ? timeModeEl.value : "off"; // off | sequential | random

        // --- Read Competition / Region / Federation / Venue ---
        // pickChecked removed
        function randomFrom(list) {
          return list[Math.floor(Math.random() * list.length)];
        }
        // Options must mirror the UI labels
        const COMP_OPTS = [
          "Elite League",
          "Nordic Cup",
          "Baltic Challenge",
          "National Qualifier",
          "Youth Invitational",
        ];
        const REG_OPTS = [
          "Northland",
          "Riverview",
          "Silver Coast",
          "Pinecrest",
          "Lakewood",
        ];
        const FED_OPTS = [
          "Northern Football Union",
          "Coastal Football Council",
          "Central League Federation",
          "Highlands Association",
          "Eastshore Federation",
        ];
        const VENUE_OPTS = [
          "Vildmannavallen IP",
          "Skellefteå Arena",
          "Umeå Stadium",
          "Kiruna Park",
          "Växjö Sports Center",
        ];

        // --- Competition/Region/Federation/Venue: use select dropdowns (plain JS) ---
        const competitionSel = document.getElementById("competition");
        let competition = competitionSel ? competitionSel.value : "";
        if (competition === "__random") competition = randomFrom(COMP_OPTS);

        const regionSel = document.getElementById("region");
        let region = regionSel ? regionSel.value : "";
        if (region === "__random") region = randomFrom(REG_OPTS);

        const federationSel = document.getElementById("federation");
        let federation = federationSel ? federationSel.value : "";
        if (federation === "__random") federation = randomFrom(FED_OPTS);

        const venueSel = document.getElementById("venue");
        let venue = venueSel ? venueSel.value : "";
        if (venue === "__random") venue = randomFrom(VENUE_OPTS);

        // Team name option
        const teamNameEl = document.querySelector(
          'input[name="teamNameOpt"]:checked'
        );
        const teamNameOpt = teamNameEl ? teamNameEl.value : "";

        // Badge library (for future)
        const badgeLibrarySel = document.getElementById("badgeLibrary");
        const badgeLibrary = badgeLibrarySel ? badgeLibrarySel.value : "";

        // Score controls
        const scoreRandom = document.getElementById("scoreRandom").checked;
        const homeScore = parseInt(
          (document.getElementById("homeScore") || {}).value || "0",
          10
        );
        const awayScore = parseInt(
          (document.getElementById("awayScore") || {}).value || "0",
          10
        );

        // Money helper (currency + three limits)
        const currencySel = document.getElementById("currency");
        const currency = currencySel ? currencySel.value : "SEK";
        function readLimit(id) {
          const el = document.getElementById(id);
          return el && el.value ? parseInt(el.value, 10) : 500;
        }
        const amount1Limit = readLimit("amt1");
        const amount2Limit = readLimit("amt2");
        const amount3Limit = readLimit("amt3");
        const qty1Limit = readLimit("qty1");
        const qty2Limit = readLimit("qty2");
        const qty3Limit = readLimit("qty3");

        const badgeBaseEl = document.getElementById("badgeBase");
        const badgeBase =
          badgeBaseEl && "value" in badgeBaseEl ? badgeBaseEl.value : "";

        showSpinner();
        parent.postMessage(
          {
            pluginMessage: {
              type: "populate",
              dateMode,
              timeMode,
              competition,
              region,
              federation,
              venue,
              teamNameOpt,
              badgeLibrary,
              badgeBase,
              scoreRandom,
              homeScore,
              awayScore,
              currency,
              amount1Limit,
              amount2Limit,
              amount3Limit,
              qty1Limit,
              qty2Limit,
              qty3Limit,
            },
          },
          "*"
        );
      };
    </script>
  </body>
</html>
